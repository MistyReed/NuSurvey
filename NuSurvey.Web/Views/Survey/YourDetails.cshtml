@model NuSurvey.Web.Controllers.SurveyResponseDetailViewModel

@{
	ViewBag.Title = "Your Survey Responses";
}

<link href="@Url.Css("TableTools.css")" rel="stylesheet" type="text/css" />

@section AdditionalScripts{
    <script type="text/javascript" src='@Url.Content("~/Scripts/jquery.dataTables.min.js")'></script>
    <script type="text/javascript" src='@Url.Content("~/Scripts/jquery.bt.min.js")'></script>
    <script type="text/javascript" src='@Url.Content("~/Scripts/TableTools.min.js")'></script>

    <script type="text/javascript">
        $(document).ready(function () {
            $("#printButton").bt();
        });
    </script>



    <script type="text/javascript">
        $(function () {
            $("#filter_container").accordion({ collapsible: true, autoHeight: false, active: false });
        });
    </script>
 

    <script type="text/javascript">
        $(document).ready(function () {
            $("#FilterBeginDate").datepicker();
            $("#FilterEndDate").datepicker();

            $('#yourDetails').dataTable({
                "bJQueryUI": true,
                "sDom": 'T<"clear">lfrtip',
                "oTableTools": {
                    "sRowSelect": "multi",
                    "aButtons": ""
                }
            });

            $("#printSelected").click(function () {
                var oTT = TableTools.fnGetInstance('yourDetails');
                var aSelectedTrs = oTT.fnGetSelected();
                var picked = new Array();
                for (i = 0; i < aSelectedTrs.length; i++) {
                    picked[i] = $(aSelectedTrs[i]).data('multi-id');
                }

                var url = '@Url.Action("PickResults2", "Print")';
                var id = '@Model.Survey.Id';
                var postData = { id: id, picked: picked };

                var xxx = $.ajax({
                    type: "GET",
                    url: url,
                    data: postData,
                    success: function (result) {
                        if (result != true) {
                            alert("There was a problem updating.");
                        }
                    },
                    dataType: "ActionResult",
                    traditional: true
                });
               
                
            });

            //A hack to fix this being removed by the TableTools above
            $(".dataTables_info").addClass("fg-toolbar ui-toolbar ui-widget-header ui-corner-bl ui-corner-br ui-helper-clearfix");
        });
    </script>

    <script type="text/javascript">
//        function fnGetSelected(oTableLocal) {
//            var aReturn = new Array();
//            var aTrs = oTableLocal.fnGetNodes();

//            for (var i = 0; i < aTrs.length; i++) {
//                if ($(aTrs[i]).hasClass('row_selected')) {
//                    aReturn.push(aTrs[i]);
//                }
//            }
//            return aReturn;
//        }

        function getSelectedIds(){
//            var oTT = TableTools.fnGetInstance('yourDetails');
//            var aSelectedTrs = oTT.fnGetSelected();
//            var picked = new Array();
//            for (i = 0; i < aSelectedTrs.length; i++) {
//                picked[i] = $(aSelectedTrs[i]).data('multi-id');
//            }

            //            return picked;

            var oTT = TableTools.fnGetInstance('yourDetails');
            var aSelectedTrs = oTT.fnGetSelected();
            var picked = new Array();
            for (i = 0; i < aSelectedTrs.length; i++) {
                picked[i] = $(aSelectedTrs[i]).data('multi-id');
            }

            var url = '@Url.Action("PickResults2", "Print")';
            var id = '@Model.Survey.Id';
            var postData = { id: id, picked: picked };

            var xxx = $.ajax({
                type: "GET",
                url: url,
                data: postData,
                success: function (result) {
                    if (result != true) {
                        alert("There was a problem updating.");
                    }
                },
                dataType: "ActionResult",
                traditional: true
            });
        }

    </script>
}
@section SubNav {
    <ul class="navigation">
        <li>
            <a href="@Url.Action("Index", "Home")">Home</a> 
        </li>
        <li>
            <a href="@Url.Action("Review", "Survey")">Surveys</a> 
        </li>
        <li>
            Responses
        </li>
    </ul>
}

<div id="filter_container">
    <h3><a href="#">Filters</a></h3>
    @using (Html.BeginForm("YourDetails", "Survey", FormMethod.Post)) {
        @Html.AntiForgeryToken();

            <ul>        
                <li>
                    <div class="editor-label">
                        @Html.Label("Response On or After Date")
                    </div>
                    <div class="editor-field">
                        @Html.TextBoxFor(a => a.FilterBeginDate)
                    </div>
                </li>
                <li>
                    <div class="editor-label">
                        @Html.Label("Response On or Before Date")
                    </div>
                    <div class="editor-field">
                        @Html.TextBoxFor(a => a.FilterEndDate)
                    </div>
                </li>
                <li>
                    <label>&nbsp;</label>
			        <input class="button" type="submit" value="Apply" />
                </li>
            </ul>

    }
</div>

    
    <table id="yourDetails" class="datatable">
	    <thead>
		    <tr>
			    <th></th>
			    <th>
				    Name
			    </th>
			    <th>
				    DateTaken
			    </th>
                <th>
                    Positive Category
                </th>
                <th>
                    Negative Category
                </th>
                <th>
                    Negative Category
                </th>
		    </tr>
	    </thead>
	    <tbody>
    @{ 
        var odd = false;
        var count = 0; 
     }
    @foreach (var item in Model.SurveyResponses) {
		    <tr class="@(odd ? "odd": "even")" data-multi-id="@item.Id">
			    <td>
                    <a href='@Url.Action("Details", "SurveyResponse", new { id = @item.Id, fromYourDetails=true })'><img alt="Details of Survey Response" src="@Url.Image("details.png")"/></a>        
			    </td>
			    <td>
				    @item.StudentId
			    </td>
			    <td>
				    @String.Format("{0:g}", item.DateTaken)
			    </td>
                <td>
                    @if (item.PositiveCategory != null) { 
                        @item.PositiveCategory.Name
                    }
                </td>
                <td>
                    @if (item.NegativeCategory1 != null) { 
                        @item.NegativeCategory1.Name
                    }
                </td>
                <td>
                    @if (item.NegativeCategory2 != null) {
                        @item.NegativeCategory2.Name
                    }
                </td>
		    </tr>
		    odd = !odd;
            count = count + 1;
    }
	    </tbody>        
    </table>

    <div class="dataTables_wrapper fg-toolbar ui-toolbar ui-widget-header ui-corner-bl ui-corner-br ui-helper-clearfix">&nbsp;</div>


<div id="printSelected">Print Selected</div>


@*<div >
    <a id="printButton" title="To limit the pages printed, use the filter on the table above." href='@Url.Action("PickResults2", "Print", new { id = @Model.Survey.Id, picked = 'getSelectedIds()' })' target="_blank"><img alt="Print these results" src="@Url.Image("big_print.png")"/></a>
</div>*@

                  
        
            <ul>        
                <li>
                    <label>&nbsp;</label>
			        <input class="button" type="button" value="Test Print" onclick="getSelectedIds()"/>
                </li>
            </ul>







